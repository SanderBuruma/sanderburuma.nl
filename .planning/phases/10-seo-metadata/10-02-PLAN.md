---
phase: 10-seo-metadata
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/plugins/seoPrerender.js
  - vite.config.js
autonomous: false

must_haves:
  truths:
    - "Social media crawlers see correct OG tags when fetching /blog/hello-world"
    - "Each blog post URL has og:title, og:description, og:image, og:url in static HTML"
    - "Twitter card tags (twitter:card, twitter:title, twitter:description, twitter:image) present"
    - "Blog index URL has OG tags in static HTML"
    - "Social media preview debuggers show correct metadata"
  artifacts:
    - path: "src/plugins/seoPrerender.js"
      provides: "Vite plugin generating per-route HTML with OG meta tags"
      exports: ["default"]
    - path: "vite.config.js"
      provides: "Updated config with seoPrerender plugin"
      contains: "seoPrerender"
  key_links:
    - from: "src/plugins/seoPrerender.js"
      to: "src/plugins/blogManifest.js"
      via: "reads same markdown files for post metadata"
      pattern: "src/content/blog"
    - from: "vite.config.js"
      to: "src/plugins/seoPrerender.js"
      via: "plugin import"
      pattern: "seoPrerender"
---

<objective>
Generate static HTML files at build time with Open Graph and Twitter Card meta tags for each blog post and the blog index. Social media crawlers (Facebook, Twitter, LinkedIn) do NOT execute JavaScript, so OG tags must be in the static HTML served for each URL.

Purpose: Covers SEO-02 (Open Graph tags) and SEO-03 (featured image in social previews). Without this, shared blog links show generic site metadata.
Output: Vite build plugin that generates /blog/index.html and /blog/{slug}/index.html with proper OG meta tags
</objective>

<execution_context>
@/home/sanderburuma/.claude/get-shit-done/workflows/execute-plan.md
@/home/sanderburuma/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/plugins/blogManifest.js
@vite.config.js
@index.html
</context>

<integration_strategy>
## How Static Prerendering and SEOHead Work Together

**Two concerns, two solutions:**
1. **Plan 02 (this plan) - seoPrerender:** Generates static HTML with baked-in OG tags at build time. Crawlers (Facebook, Twitter, LinkedIn, Google) fetch this static HTML and see correct metadata WITHOUT executing JavaScript.

2. **Plan 01 - SEOHead:** Updates meta tags dynamically for client-side navigation. After the SPA hydrates, SEOHead ensures browser tab titles and meta tags update as users navigate.

**Why both are needed:**
- Crawlers see static HTML from this plan (correct OG tags for social previews)
- Users navigating the SPA see updated titles from Plan 01 (correct browser tab titles)

**No conflict:** Crawlers parse static HTML immediately - they never wait for JavaScript. By the time SEOHead runs (after JS execution), the crawler has already left with the correct metadata from the static HTML.

**Shared asset:** Both plans use `og-default.svg` as the fallback OG image. Plan 01 creates this file in `public/images/`. This plan references it but does NOT create a duplicate.
</integration_strategy>

<tasks>

<task type="auto">
  <name>Task 1: Create SEO prerender Vite plugin</name>
  <files>src/plugins/seoPrerender.js</files>
  <action>
Create a Vite plugin that runs in the `closeBundle` hook (after build completes). It:

1. Reads the built `dist/index.html` as the base template
2. Reads all markdown files from `src/content/blog/` using the same logic as blogManifest (import and reuse parseFrontmatter/validateFrontmatter from blogManifest.js, or duplicate the minimal parsing needed)
3. For each blog post, generates `dist/blog/{slug}/index.html`:
   - Copy the base template HTML
   - Replace the `<title>` tag content with: `{post.title} | Sander Buruma`
   - Replace the existing `<meta name="description"` content with: `{post.description}`
   - Replace existing OG tags (og:title, og:description, og:url, og:image, og:type) with post-specific values
   - Replace existing Twitter tags with post-specific values
   - Set og:type to "article"
   - Set og:image to post.image if exists, else `https://sanderburuma.nl/images/og-default.svg` (NOTE: shared filename with Plan 01)
   - Set og:url to `https://sanderburuma.nl/blog/{slug}`
   - Add `<meta property="article:published_time" content="{post.date}">`
   - Add `<meta property="article:author" content="{post.author}">`
   - For each tag: `<meta property="article:tag" content="{tag}">`
4. Generate `dist/blog/index.html` for the blog index page:
   - title: "Tech Blog | Sander Buruma"
   - description: "Technical articles on software development, Python, blockchain, and web technologies by Sander Buruma."
   - og:type: "website"
   - og:url: "https://sanderburuma.nl/blog"
   - og:image: `https://sanderburuma.nl/images/og-default.svg`

Important implementation notes:
- Use string replacement on the HTML, NOT a DOM parser (keep it simple, no extra deps)
- The base index.html already has OG meta tags (see index.html), so replace them with regex
- Use `fs.mkdirSync(dir, { recursive: true })` for creating directories
- Export the function as default
- Log which files were generated: `console.log('[seo-prerender] Generated: dist/blog/{slug}/index.html')`
- The plugin should only run during build (`apply: 'build'`)
- Use `og-default.svg` (NOT `og-blog-default.svg`) - this is the shared fallback image

For replacing meta tags, use patterns like:
- `/<title>[^<]*<\/title>/` -> `<title>${newTitle}</title>`
- `/<meta property="og:title" content="[^"]*">` -> `<meta property="og:title" content="${newValue}">`
- Same pattern for og:description, og:url, og:image, og:type, twitter:*

To add NEW meta tags (article:published_time, article:author, article:tag), insert them after the last existing OG tag block. Find `<!-- Twitter -->` comment and insert before it.
  </action>
  <verify>
Run `npm run build` and check:
1. `dist/blog/hello-world/index.html` exists
2. Contains `og:title` with the hello-world post title
3. Contains `og:url` with `https://sanderburuma.nl/blog/hello-world`
4. `dist/blog/index.html` exists with blog index OG tags
5. Contains `og-default.svg` (not `og-blog-default.svg`)
  </verify>
  <done>Build generates per-post and blog-index HTML files with correct OG and Twitter Card meta tags using shared fallback image name</done>
</task>

<task type="auto">
  <name>Task 2: Register plugin in Vite config</name>
  <files>vite.config.js</files>
  <action>
Update `vite.config.js`:
- Import seoPrerender: `import seoPrerender from './src/plugins/seoPrerender.js'`
- Add `seoPrerender()` to the plugins array (after blogManifest, since it needs the build output)

Note: The fallback OG image (`og-default.svg`) is created by Plan 01 in `public/images/`. This plan does NOT create a duplicate. The image will be copied to `dist/images/og-default.svg` as part of normal Vite build (public/ -> dist/).
  </action>
  <verify>
Run `npm run build`:
1. Build succeeds without errors
2. `dist/blog/hello-world/index.html` exists with OG tags
3. `dist/blog/index.html` exists with OG tags
4. Grep for og:image in generated HTML shows correct URL with `og-default.svg`
  </verify>
  <done>Vite config updated with seoPrerender plugin, build generates all SEO HTML files</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify with social media debuggers</name>
  <what-built>
Static HTML files with OG tags for all blog posts and blog index, ready for social media crawlers.
  </what-built>
  <how-to-verify>
After deployment to production (https://sanderburuma.nl):

1. **Facebook Sharing Debugger** (https://developers.facebook.com/tools/debug/):
   - Enter: `https://sanderburuma.nl/blog/hello-world`
   - Click "Debug" (or "Scrape Again" if cached)
   - Verify: og:title shows post title, og:image shows post image or fallback, og:description shows post description

2. **Twitter Card Validator** (https://cards-dev.twitter.com/validator):
   - Enter: `https://sanderburuma.nl/blog/hello-world`
   - Verify: Card preview shows post title, description, and image

3. **LinkedIn Post Inspector** (https://www.linkedin.com/post-inspector/):
   - Enter: `https://sanderburuma.nl/blog/hello-world`
   - Click "Inspect"
   - Verify: Preview shows correct title, description, and image

4. **Blog index check:**
   - Repeat steps 1-3 with `https://sanderburuma.nl/blog`
   - Verify: Shows "Tech Blog | Sander Buruma" title and appropriate description

Expected results:
- All three debuggers show post-specific metadata (not generic site metadata)
- Images display correctly in previews
- Descriptions are truncated appropriately if needed
  </how-to-verify>
  <resume-signal>Type "approved" if all debuggers show correct metadata, or describe which platform shows incorrect data</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `dist/blog/hello-world/index.html` contains post-specific OG tags
3. `dist/blog/index.html` contains blog index OG tags
4. OG image URLs point to either post image or `og-default.svg` fallback
5. Twitter card tags present in generated HTML
6. article:published_time present for blog posts
7. Social media debuggers show correct metadata after deployment
</verification>

<success_criteria>
- Every blog post has a static HTML file with correct OG tags at its URL path
- Blog index has static HTML with OG tags
- Social media crawlers (which don't execute JS) will see post-specific metadata
- Fallback OG image is `og-default.svg` (shared with Plan 01)
- Build completes without errors
- Social media preview debuggers (Facebook, Twitter, LinkedIn) show correct metadata
</success_criteria>

<output>
After completion, create `.planning/phases/10-seo-metadata/10-02-SUMMARY.md`
</output>

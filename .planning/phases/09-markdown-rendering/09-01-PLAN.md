---
phase: 09-markdown-rendering
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/MarkdownRenderer.jsx
  - src/components/ImageLightbox.jsx
autonomous: true

must_haves:
  truths:
    - "Markdown headings, lists, links, and images render correctly as HTML"
    - "Code blocks display with syntax highlighting and line numbers"
    - "User can copy code blocks with one click"
    - "Headings show anchor link on hover"
    - "Clicking an image opens lightbox overlay"
  artifacts:
    - path: "src/components/MarkdownRenderer.jsx"
      provides: "Markdown-to-React rendering with all features"
      min_lines: 80
    - path: "src/components/ImageLightbox.jsx"
      provides: "Full-size image overlay on click"
      min_lines: 20
  key_links:
    - from: "src/components/MarkdownRenderer.jsx"
      to: "react-markdown"
      via: "import"
      pattern: "import.*ReactMarkdown.*react-markdown"
    - from: "src/components/MarkdownRenderer.jsx"
      to: "rehype-highlight"
      via: "plugin config"
      pattern: "rehypeHighlight"
---

<objective>
Create the core MarkdownRenderer component that converts raw markdown strings into rich React elements with syntax-highlighted code blocks, copy-to-clipboard, linkable headings, image lightbox, and proper image handling.

Purpose: This is the rendering engine for blog posts. All markdown features (MARK-01, MARK-02, MARK-03) live here.
Output: Reusable MarkdownRenderer component + ImageLightbox component
</objective>

<execution_context>
@/home/sanderburuma/.claude/get-shit-done/workflows/execute-plan.md
@/home/sanderburuma/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-markdown-rendering/09-CONTEXT.md
@.planning/phases/07-markdown-infrastructure/07-01-SUMMARY.md
@src/content/blog/hello-world.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install markdown dependencies</name>
  <files>package.json</files>
  <action>
    Install: `react-markdown`, `rehype-highlight`, `remark-gfm`

    react-markdown renders markdown as React components (no dangerouslySetInnerHTML).
    rehype-highlight provides syntax highlighting via highlight.js (auto-detects languages).
    remark-gfm adds GitHub Flavored Markdown (tables, strikethrough, task lists).

    Also install `highlight.js` as peer dependency for the CSS theme import.

    Run: `npm install react-markdown rehype-highlight remark-gfm highlight.js`
  </action>
  <verify>`npm ls react-markdown rehype-highlight remark-gfm highlight.js` shows all installed</verify>
  <done>All four packages in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create MarkdownRenderer and ImageLightbox components</name>
  <files>src/components/MarkdownRenderer.jsx, src/components/ImageLightbox.jsx</files>
  <action>
    **ImageLightbox.jsx:**
    - Props: `src`, `alt`, `isOpen`, `onClose`
    - Renders a fixed overlay (dark backdrop) with centered full-size image
    - Click backdrop or press Escape to close
    - useEffect to add/remove keydown listener for Escape

    **MarkdownRenderer.jsx:**
    - Props: `content` (raw markdown string)
    - Uses ReactMarkdown with plugins: `remarkGfm`, `rehypeHighlight`
    - Import a highlight.js dark theme CSS (e.g., `highlight.js/styles/atom-one-dark.css`) — this will serve both light and dark site themes since code blocks always look good on dark bg
    - Custom component overrides via `components` prop:

    **Headings (h1-h6):**
    - Generate id from text (lowercase, replace spaces with hyphens, strip non-alphanumeric)
    - Render heading with an anchor link: `<hN id={id}><a href={#id} className="heading-anchor">#</a> {children}</hN>`
    - The # anchor appears on hover via CSS (opacity 0 -> 1)

    **Code blocks (pre > code):**
    - Detect language from className (react-markdown adds `language-xxx` class)
    - Display language label in top-right corner (small text, absolute positioned)
    - Add line numbers: split code text by newlines, render numbered spans in a gutter
    - Copy button: appears on hover (top-right, next to language label). On click, copy code text to clipboard via `navigator.clipboard.writeText()`. Show "Copied!" feedback for 2 seconds then revert to copy icon.
    - Wrap in a container div with className `code-block-wrapper`

    **Images (img):**
    - Render at natural size up to max-width 100%, centered via CSS
    - If alt text exists, render a `<figcaption>` below the image with the alt text
    - Wrap in `<figure>` element
    - onClick: open ImageLightbox with this image
    - Add cursor pointer style
    - onError: show styled placeholder box with alt text (set a fallback state)

    **Links (a):**
    - External links: add `target="_blank"` and `rel="noopener noreferrer"`
    - Internal links: render as-is

    Keep the component focused — no page layout, no header/byline. Just markdown rendering.
  </action>
  <verify>
    `npm run build` succeeds.
    Inspect MarkdownRenderer.jsx: imports ReactMarkdown, rehypeHighlight, remarkGfm. Has custom components for headings, code, img, a. Has copy-to-clipboard logic.
    Inspect ImageLightbox.jsx: renders overlay with image, handles close on backdrop click and Escape key.
  </verify>
  <done>
    MarkdownRenderer accepts `content` string and renders full markdown with: syntax-highlighted code blocks with line numbers + language label + copy button, linkable headings with hover anchor, images with caption and lightbox on click, external links opening in new tab.
    ImageLightbox provides fullscreen image overlay.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with no errors
- MarkdownRenderer component exists and handles all markdown element types
- ImageLightbox component exists with open/close functionality
- No dangerouslySetInnerHTML usage (react-markdown handles safely)
</verification>

<success_criteria>
- react-markdown, rehype-highlight, remark-gfm, highlight.js installed
- MarkdownRenderer renders markdown with syntax highlighting, copy button, linkable headings, image lightbox
- ImageLightbox shows full-size image overlay
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-markdown-rendering/09-01-SUMMARY.md`
</output>

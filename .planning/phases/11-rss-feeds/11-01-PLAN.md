---
phase: 11-rss-feeds
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/plugins/rssFeed.js
  - vite.config.js
autonomous: true

must_haves:
  truths:
    - "RSS feed exists at /rss.xml after build"
    - "RSS feed includes all blog posts with title, date, description, link"
    - "RSS feed validates against RSS 2.0 specification"
    - "RSS auto-discovery tag exists in site head"
  artifacts:
    - path: "src/plugins/rssFeed.js"
      provides: "RSS XML generation at build time"
      min_lines: 60
      contains: "closeBundle"
    - path: "vite.config.js"
      provides: "Plugin registration and auto-discovery tag"
      contains: "rssFeed"
  key_links:
    - from: "src/plugins/rssFeed.js"
      to: "src/content/blog/*.md"
      via: "fs.readdirSync and fs.readFileSync"
      pattern: "fs\\.read"
    - from: "vite.config.js"
      to: "src/plugins/rssFeed.js"
      via: "import statement"
      pattern: "import rssFeed from"
---

<objective>
Generate RSS 2.0 feed at build time and add auto-discovery tag to site head.

Purpose: Enable users to subscribe to blog updates via any RSS reader. Feed readers can discover the feed automatically from any page.
Output: rssFeed.js Vite plugin, updated vite.config.js with plugin and auto-discovery tag
</objective>

<execution_context>
@/home/sanderburuma/.claude/get-shit-done/workflows/execute-plan.md
@/home/sanderburuma/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-rss-feeds/11-RESEARCH.md

# Existing plugin patterns to follow
@src/plugins/seoPrerender.js
@vite.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create rssFeed Vite plugin</name>
  <files>src/plugins/rssFeed.js</files>
  <action>
Create a new Vite plugin that generates RSS 2.0 feed at build time using the closeBundle hook (same pattern as seoPrerender.js).

Implementation details:
1. Copy parseFrontmatter and validateFrontmatter from seoPrerender.js (avoid code duplication by copying, not importing - plugins should be self-contained)
2. Add toRFC822Date function: `new Date(dateString + 'T00:00:00Z').toUTCString()`
3. Add generateRSSFeed function that creates RSS 2.0 XML string:
   - XML declaration: `<?xml version="1.0" encoding="UTF-8"?>` (no whitespace before)
   - Channel: title="Tech Blog | Sander Buruma", link="https://sanderburuma.nl/blog", description="Technical articles on software development, Python, blockchain, and web technologies by Sander Buruma."
   - language="en-US", lastBuildDate=RFC822 format
   - Items: title, link (absolute URL), description wrapped in CDATA, pubDate (RFC822), guid (same as link)
4. Export default function rssFeed() with:
   - name: 'rss-feed'
   - apply: 'build'
   - configResolved: store config
   - closeBundle: read markdown files, generate RSS XML, write to dist/rss.xml

Base URL: https://sanderburuma.nl
Sort posts by date (newest first) before generating items.
Log output: `[rss-feed] Generated: dist/rss.xml`
Log validation reminder: `[rss-feed] Validate at: https://validator.w3.org/feed/`
  </action>
  <verify>
File exists at src/plugins/rssFeed.js with:
- closeBundle hook
- toRFC822Date function
- generateRSSFeed function
- CDATA sections in description
  </verify>
  <done>rssFeed.js plugin created with RSS 2.0 generation logic</done>
</task>

<task type="auto">
  <name>Task 2: Register plugin and add auto-discovery tag</name>
  <files>vite.config.js</files>
  <action>
Update vite.config.js:

1. Add import at top: `import rssFeed from './src/plugins/rssFeed.js'`

2. Add rssFeed() to plugins array (after seoPrerender):
```javascript
plugins: [
  react(),
  blogManifest(),
  seoPrerender(),
  rssFeed(),        // ADD THIS LINE
  createHtmlPlugin({
```

3. Add RSS auto-discovery tag to createHtmlPlugin inject.tags array:
```javascript
{
  injectTo: 'head',
  tag: 'link',
  attrs: {
    rel: 'alternate',
    type: 'application/rss+xml',
    title: 'Tech Blog | Sander Buruma',
    href: 'https://sanderburuma.nl/rss.xml'
  }
}
```
Add this after the font preload tags.
  </action>
  <verify>
Run `npm run build` and verify:
1. Build succeeds without errors
2. Console shows `[rss-feed] Generated: dist/rss.xml`
3. dist/rss.xml file exists
4. dist/index.html contains `<link rel="alternate" type="application/rss+xml"`
  </verify>
  <done>Plugin registered, auto-discovery tag injected, RSS feed generated on build</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Run `npm run build` - should succeed with RSS generation log
2. Check dist/rss.xml:
   - Starts with `<?xml version="1.0" encoding="UTF-8"?>`
   - Contains `<rss version="2.0">`
   - Contains channel with title, link, description
   - Contains item(s) with title, link, description (CDATA), pubDate, guid
   - All URLs are absolute (https://sanderburuma.nl/...)
3. Check dist/index.html:
   - Contains `<link rel="alternate" type="application/rss+xml"` tag
4. Manual validation: Copy dist/rss.xml content to https://validator.w3.org/feed/#validate_by_input
   - Should show "Valid RSS" or only minor warnings

Expected RSS structure:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
  <channel>
    <title>Tech Blog | Sander Buruma</title>
    <link>https://sanderburuma.nl/blog</link>
    <description>Technical articles...</description>
    <language>en-US</language>
    <lastBuildDate>Wed, 29 Jan 2026 00:00:00 GMT</lastBuildDate>
    <item>
      <title>Hello World</title>
      <link>https://sanderburuma.nl/blog/hello-world</link>
      <description><![CDATA[Post description here]]></description>
      <pubDate>Wed, 29 Jan 2026 00:00:00 GMT</pubDate>
      <guid>https://sanderburuma.nl/blog/hello-world</guid>
    </item>
  </channel>
</rss>
```
</verification>

<success_criteria>
- [ ] npm run build succeeds
- [ ] dist/rss.xml exists and starts with XML declaration
- [ ] RSS contains all blog posts with required fields
- [ ] RSS dates are RFC 822 format (e.g., "Wed, 29 Jan 2026 00:00:00 GMT")
- [ ] RSS descriptions use CDATA sections
- [ ] All URLs in RSS are absolute
- [ ] dist/index.html contains RSS auto-discovery link tag
- [ ] W3C Feed Validator shows valid RSS (or only minor warnings)
</success_criteria>

<output>
After completion, create `.planning/phases/11-rss-feeds/11-01-SUMMARY.md`
</output>
